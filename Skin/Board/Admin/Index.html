<?php if(_BH_ !== true) exit;
use \BH_Common as CM;
use \BH_Application as App;

/**
 * @var $Model \BoardModel
 * @var $Data \BH_DB_GetListWithPage
 * @var $Ctrl \BH\Controller\Admin\Board
 */
App::JSAdd('board.js', 200);
?>
<h2><?p. $Ctrl->boardManger->GetValue('subject') ?> 게시물관리</h2>
<div class="right_btn"><a href="<?c. 'BoardManager' ?>" class="sBtn">게시판 관리로 이동</a></div>

<?php if($Data->result && $Data->totalRecord){ ?>

	<table class="list">
		<colgroup>
			<col style="width:7%;">
			<col style="">
			<col style="width:15%;">
			<col style="width:7%;">
			<col style="width:7%;">
			<col style="width:18%;">
			<col style="width:10%;">
		</colgroup>
		<thead>
		<tr>
			<th>번호</th>
			<th><?mt('subject')?></th>
			<th><?mt('mname')?></th>
			<th><?mt('hit')?></th>
			<th><?mt('recommend')?></th>
			<th><?mt('reg_date')?></th>
			<th>삭제</th>
		</tr>
		</thead>
		<tbody>
		<?php
		foreach(App::$Data['notice'] as $row){
			$secretIcon = $row['secret'] == 'y' ? '<span class="secretDoc">[비밀글]</span> ' : '';
			?>
			<tr class="notice">
				<td>공지</td>
				<td class="left">
					<a href="<?p. $row['viewUrl'] ?>"<?php if(!$row['possibleView']){ ?> class="passwordView"<?php } ?>>
						[공지] <?v. $row['subject'] ?> <?p. $row['replyCount'] ?> <?p. $secretIcon ?>
					</a>
				</td>
				<td><?v. $row['mname']; ?></td>
				<td><?v. $row['hit']; ?></td>
				<td><?v. $row['recommend']; ?></td>
				<td><?v. KrDate($row['reg_date'],'ymd', 24) ?></td>
				<td>
					<?php if($row['delis'] != 'y'){ ?>
						<a href="<?a. 'Delete/'.toBase($row['seq']) ?><?fq. '' ?>" class="deleteArticle">삭제</a>
					<?php }else{ ?>
						<a href="<?a. 'Undelete/'.toBase($row['seq']) ?><?fq. '' ?>" class="unDeleteArticle">삭제복구</a>
						<a href="<?a. 'Remove/'.toBase($row['seq']) ?><?fq. '' ?>" class="removeArticle">완전삭제</a>
					<?php } ?>
				</td>

			</tr>
		<?php } ?>
		<?php
		foreach($Data->data as $row){
			$secretIcon = $row['secret'] == 'y' ? '<span class="secretDoc">[비밀글]</span> ' : '';
			?>
			<tr>
				<td><?p. $Data->beginNum-- ?></td>
				<td class="left">
					<?php if($row['delis'] == 'y'){ ?><span class="alert">[삭제됨]</span><?php } ?>
					<a href="<?p. $row['viewUrl'] ?>"<?php if(!$row['possibleView']){ ?> class="passwordView"<?php } ?>>
						<?v. $row['subject'] ?> <?p. $row['replyCount'] ?> <?p. $secretIcon ?>
					</a>
				</td>

				<td><?v. $row['mname']; ?></td>
				<td><?v. $row['hit']; ?></td>
				<td><?v. $row['recommend']; ?></td>
				<td><?v. KrDate($row['reg_date'],'ymd', 24) ?></td>
				<td>
					<?php if($row['delis'] != 'y'){ ?>
						<a href="<?a. 'Delete/'.toBase($row['seq']) ?><?fq. '' ?>" class="deleteArticle">삭제</a>
					<?php }else{ ?>
						<a href="<?a. 'Undelete/'.toBase($row['seq']) ?><?fq. '' ?>" class="unDeleteArticle">복구</a> |
						<a href="<?a. 'Remove/'.toBase($row['seq']) ?><?fq. '' ?>" class="removeArticle">완전삭제</a>
					<?php } ?>
				</td>
			</tr>
		<?php } ?>
		</tbody>
	</table>
<?php } else{ ?>
	<p class="nothing">등록된 게시물이 없습니다.</p>
<?php } ?>

<form id="bbsSchForm" name="bbsSchForm" method="get" action="<?a. '' ?>" class="boardSearch leftBoardSearch">
	<select name="searchType">
		<?p. SelectOption(array('snc' => '제목+내용', 's' => '제목', 'c' => '내용'), isset($_GET['searchType']) ? $_GET['searchType'] : '') ?>
	</select>
	<input type="text" name="searchKeyword" value="<?v. isset($_GET['searchKeyword']) ? $_GET['searchKeyword'] : '' ?>">
	<button type="submit" class="mBtn btn2">검색</button>
</form>

<?php if($Ctrl->GetAuth('Write')){ ?><div class="right_btn"><a href="<?a. 'Write' ?><?fq. '' ?>" class="mBtn btn2">글쓰기</a></div><?php } ?>

<div class="paging"><?p. $Data->pageHtml ?></div>

<div id="secretViewForm" class="hidden boardPassword modalConfirm">
	<form id="viewForm" name="viewForm" method="post" action="">
		<input type="password" name="pwd" required="required">
		<span>비밀번호를 입력하여 주세요.</span>
		<div class="sPopBtns">
			<button type="submit" class="btn2">확인</button>
			<button type="reset" class="btn2">취소</button>
		</div>
	</form>
</div>

<div id="removeForm" class="hidden boardPassword modalConfirm">
	<form id="remForm" name="remForm" method="post" action="">
		<p>정말 완전히 삭제하시겠습니까?</p>
		<div class="sPopBtns">
			<button type="submit" class="sBtn btn2">완전삭제</button>
			<button type="reset" class="sBtn btn2">취소</button>
		</div>
	</form>
</div>


<div id="deleteForm" class="hidden boardPassword modalConfirm">
	<form id="delForm" name="delForm" method="post" action="">
		<p>정말 삭제하시겠습니까?</p>
		<div class="sPopBtns">
			<button type="submit" class="sBtn btn2">삭제하기</button>
			<button type="reset" class="sBtn btn2">취소</button>
		</div>
	</form>
</div>

<script>
	App.admin.BoardListInit();
</script>