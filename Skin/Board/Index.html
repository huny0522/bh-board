<?php if(_BH_ !== true) exit;
use \BH_Common as CF;
use \BH_Application as App;

/**
 * @var $Model \BoardModel
 * @var $Data \BH_DB_GetListWithPage
 * @var $this \BH_Application
 */
?>

<table class="list">
	<colgroup>
		<col style="width:7%;">
		<col style="">
		<col style="width:15%;">
		<col style="width:7%;">
		<col style="width:7%;">
		<col style="width:18%;">
	</colgroup>
	<thead>
	<tr>
		<th>번호</th>
		<th><?p. $Model->data['subject']->DisplayName ?></th>
		<th><?p. $Model->data['mname']->DisplayName ?></th>
		<th><?p. $Model->data['hit']->DisplayName ?></th>
		<th><?p. $Model->data['recommend']->DisplayName ?></th>
		<th><?p. $Model->data['reg_date']->DisplayName ?></th>
	</tr>
	</thead>
	<tbody>
	<?php if($Data->result && $Data->totalRecord){ ?>
		<?php
		while($row = $Data->Get()){
			$secretIcon = $row['secret'] == 'y' ? '<span class="secretDoc">[비밀글]</span> ' : '';
			?>
			<tr>
				<td><?p. $Data->beginNum-- ?></td>
				<td class="left">
					<?v. $row['category'] ? '['.$row['category'].']' : '' ?>
					<?php if($Ctrl->managerIs || $row['secret'] == 'n' || (_MEMBERIS === true && $_SESSION['member']['level'] == _SADMIN_LEVEL) || ($row['first_member_is'] == 'y' && strlen($row['muid']))){ ?>
						<?p. $secretIcon ?><a href="<?a. 'View' ?>/<?p. toBase($row['seq']) ?><?fq. '' ?>"><?v. $row['subject']; ?><?php if($row['reply_cnt']){ ?><span class="ReplyCount">[<?p. $row['reply_cnt'] ?>]</span><?php } ?></a>
					<?php } else { ?>
						<?p. $secretIcon ?><a href="<?a. 'View' ?>/<?p. toBase($row['seq']) ?><?fq. '' ?>" class="passwordView"><?v. $row['subject']; ?><?php if($row['reply_cnt']){ ?><span class="ReplyCount">[<?p. $row['reply_cnt'] ?>]</span><?php } ?></a>
					<?php } ?>
				</td>

				<td><?v. $row['mname']; ?></td>
				<td><?v. $row['hit']; ?></td>
				<td><?v. $row['recommend']; ?></td>
				<td><?v. KrDate($row['reg_date'],'ymd', 24) ?></td>
			</tr>
		<?php } ?>
	<?php } else{ ?>
		<tr><td colspan="6" class="nothing">등록된 게시물이 없습니다.</td></tr>
	<?php } ?>
	</tbody>
</table>

<form id="bbsSchForm" name="bbsSchForm" method="get" action="<?a. '' ?>" class="boardSearch leftBoardSearch">
	<?p. $this->GetFollowQueryInput() ?>
	<select name="searchType">
		<?p. SelectOption(array('snc' => '제목+내용', 's' => '제목', 'c' => '내용'), isset($_GET['searchType']) ? $_GET['searchType'] : '') ?>
	</select>
	<input type="text" name="searchKeyword" value="<?v. isset($_GET['searchKeyword']) ? $_GET['searchKeyword'] : '' ?>">
	<button type="submit" class="mbtn btn2">검색</button>
</form>

<?php if($Ctrl->GetAuth('Write')){ ?><div class="right_btn"><a href="<?a. 'Write' ?><?fq. '' ?>" class="mbtn btn2">글쓰기</a></div><?php } ?>

<div class="paging"><?p. $Data->pageHtml ?></div>

<div id="secretViewForm" class="hidden boardPassword modalConfirm">
	<form id="viewForm" name="viewForm" method="post" action="">
		<input type="password" name="pwd" required="required">
		<span>비밀번호를 입력하여 주세요.</span>
		<div class="sPopBtns">
			<button type="submit" class="btn2">확인</button>
			<button type="reset" class="btn2">취소</button>
		</div>
	</form>
</div>

<script>
	$('.passwordView').on('click', function(e){
		e.preventDefault();
		$('#viewForm').attr('action', this.href);
		$('#secretViewForm').show();
	});
	$('#secretViewForm button[type=reset]').on('click', function(e){
		$('#secretViewForm').hide();
	});
</script>