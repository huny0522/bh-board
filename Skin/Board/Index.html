<?php if(_BH_ !== true) exit;
use \BH_Common as CM;
use \BH_Application as App;

/**
 * @var $Model \BoardModel
 * @var $Data \BH_DB_GetListWithPage
 * @var $Ctrl \BH\Controller\Board
 */
?>
<?php if($Data->result && $Data->totalRecord){ ?>

	<table class="list">
		<colgroup>
			<col style="width:7%;">
			<col style="">
			<col style="width:15%;">
			<col style="width:7%;">
			<col style="width:7%;">
			<col style="width:18%;">
		</colgroup>
		<thead>
		<tr>
			<th>번호</th>
			<th><?mt('subject')?></th>
			<th><?mt('mname')?></th>
			<th><?mt('hit')?></th>
			<th><?mt('recommend')?></th>
			<th><?mt('reg_date')?></th>
		</tr>
		</thead>
		<tbody>
		<?php
		foreach(App::$Data['notice'] as $row){
			$secretIcon = $row['secret'] == 'y' ? '<span class="secretDoc">[비밀글]</span> ' : '';
			?>
			<tr class="notice">
				<td>공지</td>
				<td class="left">
					<a href="<?p. $row['viewUrl'] ?>"<?php if(!$row['possibleView']){ ?> class="passwordView"<?php } ?>>
						[공지] <?v. $row['subject'] ?> <?p. $row['replyCount'] ?> <?p. $secretIcon ?>
					</a>
				</td>
				<td><?v. $row['mname']; ?></td>
				<td><?v. $row['hit']; ?></td>
				<td><?v. $row['recommend']; ?></td>
				<td><?v. KrDate($row['reg_date'],'ymd', 24) ?></td>
			</tr>
		<?php } ?>
		<?php
		foreach($Data->data as $row){
			$secretIcon = $row['secret'] == 'y' ? '<span class="secretDoc">[비밀글]</span> ' : '';
			?>
			<tr>
				<td><?p. $Data->beginNum-- ?></td>
				<td class="left">
					<a href="<?p. $row['viewUrl'] ?>"<?php if(!$row['possibleView']){ ?> class="passwordView"<?php } ?>>
						<?v. $row['subject'] ?> <?p. $row['replyCount'] ?> <?p. $secretIcon ?>
					</a>
				</td>

				<td><?v. $row['mname']; ?></td>
				<td><?v. $row['hit']; ?></td>
				<td><?v. $row['recommend']; ?></td>
				<td><?v. KrDate($row['reg_date'],'ymd', 24) ?></td>
			</tr>
		<?php } ?>
		</tbody>
	</table>
<?php } else{ ?>
	<p class="nothing">등록된 게시물이 없습니다.</p>
<?php } ?>

<form id="bbsSchForm" name="bbsSchForm" method="get" action="<?a. '' ?>" class="boardSearch leftBoardSearch">
	<select name="searchType">
		<?p. SelectOption(array('snc' => '제목+내용', 's' => '제목', 'c' => '내용'), isset($_GET['searchType']) ? $_GET['searchType'] : '') ?>
	</select>
	<input type="text" name="searchKeyword" value="<?v. isset($_GET['searchKeyword']) ? $_GET['searchKeyword'] : '' ?>">
	<button type="submit" class="mBtn btn2">검색</button>
</form>

<?php if($Ctrl->GetAuth('Write')){ ?><div class="right_btn"><a href="<?a. 'Write' ?><?fq. '' ?>" class="mBtn btn2">글쓰기</a></div><?php } ?>

<div class="paging"><?p. $Data->pageHtml ?></div>

<div id="secretViewForm" class="hidden boardPassword modalConfirm">
	<form id="viewForm" name="viewForm" method="post" action="">
		<input type="password" name="pwd" required="required">
		<span>비밀번호를 입력하여 주세요.</span>
		<div class="sPopBtns">
			<button type="submit" class="btn2">확인</button>
			<button type="reset" class="btn2">취소</button>
		</div>
	</form>
</div>

<script>
	$('.passwordView').on('click', function(e){
		e.preventDefault();
		$('#viewForm').attr('action', this.href);
		$('#secretViewForm').show();
	});
	$('#secretViewForm button[type=reset]').on('click', function(e){
		$('#secretViewForm').hide();
	});
</script>