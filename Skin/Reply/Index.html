<?php if(_BH_ !== true) exit;
use \BH_Common as CF;
use \BH_Application as App;

/**
 * @var $Data \BH_DB_GetListWithPage
 * @var $this \BH_Application
 */
?>
<?php if($Ctrl->GetAuth()){ ?>
	<h3>댓글 <span>(<?p. $Data->totalRecord ?>)</span></h3>
	<div id="replyWrite" class="replyWrite">
		<form id="replyWriteForm" name="replyWriteForm" method="post" action="<?a. 'Write' ?>" autocomplete="off" class="reply_form">
			<input type="hidden" name="article_seq" value="<?p. self::$_Value['article_seq'] ?>" id="rep_article_seq" />

			<?php if(_MEMBERIS !== true){ ?>
				<fieldset class="user">
					<dl>
						<dt>이름</dt>
						<dd><input type="text" name="mname" required /></dd>
					</dl>
					<dl>
						<dt>패스워드</dt>
						<dd><input type="password" name="pwd" required /></dd>
					</dl>
				</fieldset>
			<?php } ?>

			<fieldset class="text">
				<textarea name="comment" placeholder="내용을 입력해 주세요."required ></textarea>

				<div class="btn">
					<span><button type="submit">등록</button></span>
				</div>
			</fieldset>

			<div class="option">
				<span><input type="checkbox" name="secret" value="y" id="reply_secret" /><label for="reply_secret">비밀글</label></span>
			</div>


		</form>
	</div>
<?php } ?>

<div id="replyListContents">

	<?php if($Data->result && $Data->totalRecord){ ?>
			<?php foreach($Data->data as $row){?>
			<article data-seq="<?p. $row['seq'] ?>" id="repArticle<?p. $row['seq'] ?>">
				<header>
					<b><?v. $row['mname']; ?></b>
					<span><?p. $row['kdate']; ?></span>
					<div class="btns">
						<?php if(!$row['secretIs'] && $row['delis'] != 'y'){ ?>
							<?php if($Ctrl->GetAuth()){ ?>
								<a href="#" class="answerBtn">답변</a>
								<?php if($row['modifyAuth']){ ?> <a href="#" class="modifyBtn<?php if($row['modifyAuthDirect']){ ?> myDoc<?php } ?>">수정</a><?php } ?>
								<?php if($row['deleteAuth']){ ?> <a href="#" class="deleteBtn<?php if($row['modifyAuthDirect']){ ?> myDoc<?php } ?>">삭제</a><?php } ?>
							<?php } ?>
						<?php } ?>
					</div>
				</header>
				<div class="comment">
					<?php if($row['file']){ ?>
						<div>
							<span><img src="<?p. _UPLOAD_URL ?><?v. $row['file'] ?>" alt=""></span>
						</div>
					<?php } ?>
					<p>
						<?php if($row['target_mname']){ ?>
							<b><?v. $row['target_mname'] ?></b>
						<?php } ?>
						<?php if($row['secret'] == 'y'){ ?><span class="secretDoc">[비밀글]</span><?php } ?>
						<span class="commentText"><?p. nl2br(GetDBText($row['comment'])) ?><?php if($row['secretIs'] && $row['first_member_is'] != 'y' && _MEMBERIS !== true){ ?> <a href="#" class="pwdView">글보기</a><?php } ?></span>
					</p>
				</div>
			</article>
		<?php } ?>
	<?php } else{ ?>
		<p class="nothing">등록된 댓글이 없습니다.</p>
	<?php } ?>
</div>
<div id="replyPaging"><?p. $Data->pageHtml ?></div>

<?php if(_MEMBERIS !== true){ ?>
	<div id="replyPwdLayer" class="repLayer hidden">
		<form id="repPwdForm" name="repPwdForm" method="post" action="<?a. 'ViewSecret' ?>">
			<input type="hidden" name="article_seq" value="<?p. self::$_Value['article_seq'] ?>">
			<input type="hidden" name="seq" value="">

			<fieldset class="pwd">
				<p>비밀글을 보시려면 비밀번호를 입력하여 주세요.</p>
				<input type="password" name="pwd" required>
			</fieldset>

			<div>
				<button type="submit" class="sbtn btn2">확인</button>
				<button type="reset" class="sbtn">취소</button>
			</div>
		</form>
	</div>
<?php } ?>

<div id="replyDeleteLayer" class="repLayer hidden">
	<form id="repDeleteForm" name="repDeleteForm" method="post" action="<?a. 'Delete' ?>">
		<input type="hidden" name="article_seq" value="<?p. self::$_Value['article_seq'] ?>">
		<input type="hidden" name="seq" value="">
			<fieldset class="pwd">
				<p>정말 삭제하시겠습니까?<br><span class="pwdinp">삭제하시려면 비밀번호를 입력하여 주세요.</span></p>
				<span class="pwdinp"><input type="password" name="pwd" required></span>
			</fieldset>
		<div class="btn">
			<button type="submit" class="sbtn btn2">확인</button>
			<button type="reset" class="sbtn">취소</button>
		</div>
	</form>
</div>

<div id="replyModifyLayer" class="repLayer hidden">
	<form id="repModifyForm" name="repModifyForm" method="post" action="<?a. 'Modify' ?>">
		<input type="hidden" name="article_seq" value="<?p. self::$_Value['article_seq'] ?>">
		<input type="hidden" name="seq" value="">

		<fieldset class="text">
			<textarea name="comment" placeholder="내용을 입력해 주세요."required ></textarea>
		</fieldset>

		<fieldset class="pwd pwdinp">
			<p>이전에 입력하신 비밀번호를 입력하여 주세요.</p>
			<input type="password" name="pwd" required>
		</fieldset>

		<div class="btn">
			<span><button type="submit" class="sbtn btn2">등록</button></span>
			<span><button type="reset" class="sbtn">취소</button></span>
		</div>
	</form>
</div>

<div id="replyAnswerLayer" class="repLayer hidden">
	<form id="repAnswerForm" name="repAnswerForm" method="post" action="<?a. 'Answer' ?>">
		<input type="hidden" name="article_seq" value="<?p. self::$_Value['article_seq'] ?>">
		<input type="hidden" name="seq" value="">
		<input type="hidden" name="target_seq" value="">

		<div class="targetContent">
			<header>
				<b></b>
				<span></span>
			</header>
			<p></p>
		</div>
		<?php if(_MEMBERIS !== true){ ?>
			<fieldset class="user">
				<dl>
					<dt>이름</dt>
					<dd><input type="text" name="mname" required /></dd>
				</dl>
				<dl>
					<dt>패스워드</dt>
					<dd><input type="password" name="pwd" required /></dd>
				</dl>
			</fieldset>
		<?php } ?>

		<fieldset class="text">
			<textarea name="comment" placeholder="내용을 입력해 주세요."required ></textarea>
		</fieldset>

		<div class="btn">
			<span><button type="submit" class="sbtn btn2">등록</button></span>
			<span><button type="reset" class="sbtn btn">취소</button></span>
		</div>
	</form>
</div>
