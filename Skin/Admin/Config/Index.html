<?php
if(_BH_ !== true) exit;
use \BH_Common as CM;
use \BH_Application as App;

/**
 * @var $Ctrl \Controller\Admin\Config
 */

$NaverClientId = CM::Config('Default', 'NaverClientId');
$useLatLng = true;
if(strlen($NaverClientId)){
	App::JSAdd('https://openapi.map.naver.com/openapi/v3/maps.js?clientId='. $NaverClientId . '&submodules=geocoder');
}
?>

<h2><?p. AdminTitleSet() ?></h2>

<form name="ConfigForm" id="ConfigForm" method="post" action="<?a. 'Write' ?>" enctype="multipart/form-data">
	<input type="hidden" name="Code" value="<?v. App::$Data['Code'] ?>">
	<input type="hidden" name="lat" value="<?v. CM::Config(App::$Data['Code'], 'lat') ?>" id="MD_lat">
	<input type="hidden" name="lng" value="<?v. CM::Config(App::$Data['Code'], 'lng') ?>" id="MD_lng">

	<fieldset>
		<h3>기본설정</h3>

		<table class="write">
			<colgroup>
				<col style="width:150px;">
				<col>
				<col style="width:150px;">
				<col>
			</colgroup>
			<tr>
				<th>회사명</th>
				<td colspan="3">
					<input type="text" name="Company" value="<?v. CM::Config(App::$Data['Code'], 'Company') ?>" class="w30p">
				</td>
			</tr>
			<tr>
				<th>사이트명</th>
				<td colspan="3">
					<input type="text" name="SiteName" value="<?v. CM::Config(App::$Data['Code'], 'SiteName') ?>" class="w100p">
				</td>
			</tr>
			<tr>
				<th>회사주소</th>
				<td colspan="3" class="daumAddress">
					<p>
						<input type="text" name="zipcode" value="<?v. CM::Config(App::$Data['Code'], 'zipcode') ?>" class="zipcode w10p">
						<button type="button" class="sBtn" id="findAddressBtn1">우편번호 찾기</button>
					</p>
					<p>
						<input type="text" id="MD_address1" name="Address1" value="<?v. CM::Config(App::$Data['Code'], 'Address1') ?>" class="address1 w40p">&nbsp;&nbsp;&nbsp;
						상세주소 : <input type="text" id="MD_address2" name="Address2" value="<?v. CM::Config(App::$Data['Code'], 'Address2') ?>" class="address2 w40p"><br>
					</p>
				</td>
			</tr>
			<tr>
				<th>대표자명</th>
				<td>
					<input type="text" name="CEO" value="<?v. CM::Config(App::$Data['Code'], 'CEO') ?>" class="w40p">
				</td>
				<th>이메일</th>
				<td>
					<input type="text" name="Email" value="<?v. CM::Config(App::$Data['Code'], 'Email') ?>" class="w100p">
				</td>
			</tr>
			<tr>
				<th>연락처</th>
				<td>
					<input type="text" name="Tel" value="<?v. CM::Config(App::$Data['Code'], 'Tel') ?>" class="w60p">
				</td>
				<th>팩스</th>
				<td>
					<input type="text" name="Fax" value="<?v. CM::Config(App::$Data['Code'], 'Fax') ?>" class="w60p">
				</td>
			</tr>
			<tr>
				<th>사업자등록번호</th>
				<td>
					<input type="text" name="bNumber" value="<?v. CM::Config(App::$Data['Code'], 'bNumber') ?>" class="w60p">
				</td>
				<th>통신판매업 신고번호</th>
				<td>
					<input type="text" name="oNumber" value="<?v. CM::Config(App::$Data['Code'], 'oNumber') ?>" class="w60p">
				</td>
			</tr>
			<tr>
				<th>개인정보책임자 연락처</th>
				<td>
					<input type="text" name="privacyTel" value="<?v. CM::Config(App::$Data['Code'], 'privacyTel') ?>" class="w40p">
				</td>
				<th>개인정보책임자 이메일</th>
				<td>
					<input type="text" name="privacyEmail" value="<?v. CM::Config(App::$Data['Code'], 'privacyEmail') ?>" class="w40p">
				</td>
			</tr>
			<tr>
				<th>통합고객센터</th>
				<td colspan="3">
					<input type="text" name="csTel" value="<?v. CM::Config(App::$Data['Code'], 'csTel') ?>" class="w40p">
				</td>
			</tr>
			<tr>
				<th>통합고객센터 시간</th>
				<td colspan="3">
					<textarea name="csTelTime"><?v. CM::Config(App::$Data['Code'], 'csTelTime') ?></textarea>
				</td>
			</tr>
		</table>
	</fieldset>

	<fieldset>
		<h3>사이트내용설정</h3>

		<table class="write">
			<tr>
				<th>로고</th>
				<td colspan="3">
					<?p. $Ctrl->_ImageInput(App::$Data['Code'], 'LogoUrl') ?>
				</td>
			</tr>
			<tr>
				<th>하단로고</th>
				<td colspan="3">
					<?p. $Ctrl->_ImageInput(App::$Data['Code'], 'FootLogoUrl') ?>
				</td>
			</tr>
			<tr>
				<th>모바일 로고</th>
				<td colspan="3">
					<?p. $Ctrl->_ImageInput(App::$Data['Code'], 'MobileLogoUrl') ?>
				</td>
			</tr>
			<tr>
				<th>이메일 상단로고</th>
				<td colspan="3">
					<?p. $Ctrl->_ImageInput(App::$Data['Code'], 'EmailLogoUrl') ?>
				</td>
			</tr>
			<tr>
				<th>이미지 없음</th>
				<td colspan="3">
					<?p. $Ctrl->_ImageInput(App::$Data['Code'], 'noImg') ?>
				</td>
			</tr>
			<?php if(class_exists('\\PHP_ICO')){ ?>
			<tr>
				<th>Favicon</th>
				<td colspan="3">
					<?p. $Ctrl->_ImageInput(App::$Data['Code'], 'FaviconPng') ?>
				</td>
			</tr>
			<?php } ?>
			<tr>
				<th>COPYRIGHT</th>
				<td colspan="3">
					<input type="text" name="Copyright" value="<?v. CM::Config(App::$Data['Code'], 'Copyright') ?>" class="w100p">
				</td>
			</tr>
			<tr>
				<th>추가 HEAD</th>
				<td colspan="3">
					<textarea name="addHead"><?v. CM::Config(App::$Data['Code'], 'addHead') ?></textarea>
				</td>
			</tr>
			<tr>
				<th>새글 표시기간</th>
				<td colspan="3">
					<input type="text" name="NewIconDay" value="<?v. CM::Config(App::$Data['Code'], 'NewIconDay') ?>" class="w5p">
				</td>
			</tr>
		</table>
	</fieldset>

	<fieldset>
		<h3>사이트환경설정</h3>

		<table class="write">
			<?php if(isset(App::$SettingData['tinyMCEPath']) && strlen(App::$SettingData['tinyMCEPath']) && file_exists(_DIR . App::$SettingData['tinyMCEPath'])){ ?>
			<tr>
				<th>HTML 에디터</th>
				<td colspan="3">
					<label class="radio"><input type="radio" name="htmlEditor" value="smarteditor2" <?p. CM::Config(App::$Data['Code'], 'htmlEditor') != 'tinymce' ? 'checked' : '' ?>><span>SmartEditor2</span></label>

					<label class="radio"><input type="radio" name="htmlEditor" value="tinymce" <?p. CM::Config(App::$Data['Code'], 'htmlEditor') == 'tinymce' ? 'checked' : '' ?>><span>TinyMCE</span></label>
				</td>
			</tr>
			<?php } ?>
			<tr>
				<th>메일아이디 사용</th>
				<td colspan="3">
					<label class="checkbox"><input type="checkbox" name="useMailId" value="y" <?p. CM::Config(App::$Data['Code'], 'useMailId') == 'y' ? 'checked' : '' ?>><span>사용</span></label>

					<label class="checkbox"><input type="checkbox" name="mailIdAddrSelection" value="y" <?p. CM::Config(App::$Data['Code'], 'mailIdAddrSelection') == 'y' ? 'checked' : '' ?>><span>메일주소 선택 표시</span></label>
				</td>
			</tr>
			<tr>
				<th>가입 즉시 사용</th>
				<td colspan="3">
					<label class="radio"><input type="radio" name="joinApprove" value="n" <?p. CM::Config(App::$Data['Code'], 'joinApprove') != 'y' ? 'checked' : '' ?>><span>가입 후 승인 필요</span></label>

					<label class="radio"><input type="radio" name="joinApprove" value="y" <?p. CM::Config(App::$Data['Code'], 'joinApprove') == 'y' ? 'checked' : '' ?>><span>가입즉시 로그인 가능</span></label>
				</td>
			</tr>
			<tr>
				<th>이메일 인증 사용</th>
				<td colspan="3">
					<label class="radio"><input type="radio" name="EmailCer" value="y" <?p. CM::Config(App::$Data['Code'], 'EmailCer') != 'n' ? 'checked' : '' ?>><span>이메일 인증 사용</span></label>

					<label class="radio"><input type="radio" name="EmailCer" value="n" <?p. CM::Config(App::$Data['Code'], 'EmailCer') == 'n' ? 'checked' : '' ?>><span>이메일 인증 사용안함</span></label>
					<ul class="guide">
						<li>* 이메일 인증을 사용하려면 '가입 후 승인 필요'로 설정하셔야합니다.</li>
						<li>* 이메일 인증시 승인이 자동으로 됩니다.</li>
					</ul>
				</td>
			</tr>
			<tr>
				<th>발송메일주소</th>
				<td>
					<input type="text" name="SendEmail" value="<?v. CM::Config(App::$Data['Code'], 'SendEmail') ?>" class="w100p">
				</td>
				<th>발송메일표시명</th>
				<td>
					<input type="text" name="EmailName" value="<?v. CM::Config(App::$Data['Code'], 'EmailName') ?>" class="w100p">
				</td>
			</tr>
			<tr>
				<th>네이버 CLIENT ID</th>
				<td>
					<input type="text" name="NaverClientId" value="<?v. CM::Config(App::$Data['Code'], 'NaverClientId') ?>" class="w100p">
				</td>
				<th>네이버 SECRET KEY</th>
				<td>
					<input type="text" name="NaverSKey" value="<?v. CM::Config(App::$Data['Code'], 'NaverSKey') ?>" class="w100p">
				</td>
			</tr>
			<tr>
				<th>인스타그램</th>
				<td colspan="3">
					<p>
						client id : <input type="text" name="InstagramCID" value="<?v. CM::Config(App::$Data['Code'], 'InstagramCID') ?>" class="w30p">
						redirect uri : <input type="text" name="InstagramRUri" value="<?v. CM::Config(App::$Data['Code'], 'InstagramRUri') ?>" class="w50p">
					</p>
					<p>access token : <input type="text" name="InstagramToken" value="<?v. CM::Config(App::$Data['Code'], 'InstagramToken') ?>" class="w30p">

						<a href="#" id="getIgAccessToken" class="sBtn">access token 받기</a>
					<p class="guide">*'client id'항목과 'redirect uri'항목을 먼저 먼저 입력 후 토큰받기를 시도하세요.</p>
					</p>

					<script>
						$(document).ready(function(){
							$('#getIgAccessToken').on('click', function(e){
								e.preventDefault();
								var ig_cid = $('input[name=InstagramCID]').val();
								var ig_uri = $('input[name=InstagramRUri]').val();
								window.open('https://api.instagram.com/oauth/authorize/?client_id=' + ig_cid + '&redirect_uri=' + ig_uri + '&scope=public_content&response_type=token');
							});
						});
					</script>
				</td>
			</tr>
		</table>
	</fieldset>

	<div class="bottomBtn">
		<button type="submit" class="bBtn">확인</button>
		<button type="reset" class="bBtn">취소</button>
		<a href="#" class="backbtn bBtn">뒤로</a>
	</div>
</form>
<script>
	$(document).on('submit', '#ConfigForm', function(e){
		var res = $(this).validCheck();
		if(!res){
			e.preventDefault();
			return false;
		}
	});

	$(document).on('click', '#findAddressBtn1', App.FindDaumAddress);

	<?php if($useLatLng){ ?>
	$('#MD_address2, #MD_address2').on('focusout', function(){
		if(!this.hasAttribute('data-before') || $(this).attr('data-before') !== $(this).val()){

			var addr1 = $.trim($('#MD_address1').val());
			var addr2 = $.trim($('#MD_address2').val());

			if(addr1 === '' || addr2 === ''){
				$('#MD_lat').val('');
				$('#MD_lng').val('');
				return;
			}

			<?php if(strlen($NaverClientId)){ ?>
			var addressToLoc = App.AddressToLocByNaver;
			<?php }else{ ?>
			var addressToLoc = App.AddressToLocByGoogle;
			<?php } ?>
			addressToLoc(addr1, addr2, function(lat, lng){
				console.log(lat,lng);
				if(lat === false){
					$('#MD_lat').val('');
					$('#MD_lng').val('');
					return;
				}
				$('#MD_lat').val(lat);
				$('#MD_lng').val(lng);
			});
		}
	});
	<?php } ?>
</script>